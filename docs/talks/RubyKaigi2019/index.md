# Introductions

Note:
- jez: Carnegie Mellon grad, previous experience rolling out Flow at Stripe.
- pt: Stanford grad, Previously at Facebook on HHVM and Hack
PT starts talking here

---
# Background
### Why Gradual Typing
### State of Sorbet

---
## Stripe
- Platform that developers use to accept payments
- 32 countries, millions of business worldwide
- Billions of dollars of processing volume annually
- 80% of adults in US bought something on Stripe last year
- 1,700 people in 10 offices around the world
- If you're running an internet business, check us out
- stripe.com/jobs

Note:

---
## Developer Productivity

- Testing
- Code
- Dev Env
- Abstractions
- Language Tools
- Docs
- Platform Teams
- Etc.

Note:

- Context
- Not overhead
---
## Ruby at Stripe

- Ruby is the primary programming language
  - No Rails
  - Enforced subset of Ruby
- Most product code is in a monorepo (intentionally!)
- ~10 macroservices with a few microservices
- New code mostly goes into an existing service

Note:

- Millions of lines of Ruby
---
## Scale

- Millions of lines of code
- Hundreds of engineers
- Thousands of commits per day
Note:

- Top languages
- Most product engineers use Ruby.
- Next language is 2% - bash
---
## Other ruby typing
- RDL by Jeff Foster and students
- Adopted GitHub Ruby parser by @charliesom

Note:

- Diamondback Ruby
- RDL Jeff Foster Maryland
- Charlie Somerville at Github
---
## Open source?
- Yes! Soon.
- Already in Private Beta
  - 3 other companies contributed code
  - 5 testing it as users
- Want in? 
  - sorbet@stripe.com

Note:

Now open: https://sorbet.run/#%221%22%20%2B%202

---
Try it ‚Üì

https://sorbet.run


---
### Background
# Why Gradual Typing
### State of Sorbet
---
### Background
### Why Gradual Typing
# State of Sorbet
---
## Ruby 3 will have Types!

- We are very happy to be a part of its development
- See Matz‚Äôs, Satourosan‚Äôs and Endosan‚Äôs talks
- Will not have inline definitions 
- Will have have side `.rbi` files
- Close to but not quite Ruby format
- Sorbet will understand both `.rbi` formats 
---
## LSP
---
## VSCode


![](img/vscode.png)


Note:

- Real looking code
- Fix a typo
- Jump to definition
- Autocomplete
- Documentation
- 
---
By the way, this is live

http://sorbet.run

<div style="height: 500px">
![](img/qrcode.png)
</div>

---
## Code Browsing (by Sourcegraph)
![](img/sourcegraph.gif)


Note:
- Beauty of LSP support is it is cross editor
- Our friends over at Sourcegraph already have LSP support
- We gave them access to the Sorbet sourcecode and they took our webasm pipeline and exposed our `--lsp` mode and magically it worked!
---
## Gemfile
```ruby
  gem 'sorbet', :group => :development
  gem 'sorbet-runtime'
```
---
## `srb init` (by Coinbase)
```bash
‚ùØ srb init
üëã Hey there!
This script will get this project ready to use with Sorbet by 
creating a `sorbet/` folder for your project. It will contain:

...

‚úÖ Done!
This project is now set up for use with Sorbet.
```

---
```bash
‚ùØ srb
No errors! Great job.
```
---
## DSL Extension (by Shopify)
```ruby
sig { returns(T.nilable(::Integer)) }
def my_id; end

sig { returns(T.any(::TrueClass, ::FalseClass)) }
def my_id?; end

sig { params(new_value: T.nilable(::Integer)).void }
def my_id=(new_value); end
```
---
```ruby
class Product < ApplicationRecord
  attribute :shop_id, :big_integer
  attribute :name, :string
  attribute :created_at, :datetime
  attribute :updated_at, :datetime

  belongs_to :shop, inverse_of: :products
  has_many :variants
end
```
---
## Rails
```
‚ùØ rails new blog
```
<div style="height:400px">
![](img/rails_new.png)
</div>

---
## It typechecks!
``` bash
‚ùØ git grep -h typed: | sort | uniq -c
   2 # typed: autogenerated
   2 # typed: false
  82 # typed: true
  17 # typed: strict
  19 # typed: strong
```
---
## New feature: `bind`
```ruby
class Rails::Application
  sig do
    params(
        blk: T.proc.bind(Rails::Application).void
    )
    .void
  end
  def configure(&blk); end
end
```
---
## Typechecking Rails
- Only needed 7 hand-written type signatures
- 1 new feature
- Most other signatures are autogenerated by reflection
---
## Roadmap

TODO

---
## Closing
- Already in private beta
- Open sourcing RealSoonNow
- Editors under active development
- Roadmap
---

Thank you!

sorbet@stripe.com
